<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your Account</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .registration-container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background-color: white;
        }
        .password-strength {
            height: 5px;
            margin-top: 5px;
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }
        .strength-0 { width: 20%; background-color: #dc3545; }
        .strength-1 { width: 40%; background-color: #fd7e14; }
        .strength-2 { width: 60%; background-color: #ffc107; }
        .strength-3 { width: 80%; background-color: #20c997; }
        .strength-4 { width: 100%; background-color: #198754; }
        .password-rules {
            font-size: 0.85rem;
            color: #6c757d;
        }
        .form-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-light">
    <div class="registration-container">
        <h1 class="h3 mb-4 text-center">Create Your Account</h1>
        
        <form method="post" action="/register" id="registrationForm" novalidate>
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            <!-- Username Field -->
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-person-fill"></i>
                    </span>
                    <input type="text" 
                           class="form-control" 
                           id="username" 
                           name="username" 
                           required
                           minlength="3"
                           maxlength="30"
                           pattern="[a-zA-Z0-9_]+"
                           title="Only letters, numbers, and underscores allowed">
                </div>
                <div class="form-text">3-30 characters. Letters, numbers, and underscores only.</div>
            </div>
            
            <!-- Email Field -->
            <div class="mb-3">
                <label for="email" class="form-label">Email Address</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-envelope-fill"></i>
                    </span>
                    <input type="email" 
                           class="form-control" 
                           id="email" 
                           name="email" 
                           required>
                </div>
            </div>
            
            <!-- Password Field -->
            <div class="mb-3 position-relative">
                <label for="password" class="form-label">Password</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-lock-fill"></i>
                    </span>
                    <input type="password" 
                           class="form-control" 
                           id="password" 
                           name="password" 
                           required
                           minlength="8"
                           aria-describedby="passwordHelp">
                    <i class="bi bi-eye-slash form-icon" id="togglePassword"></i>
                </div>
                <div class="password-strength mt-2" id="passwordStrength"></div>
                <div id="passwordHelp" class="form-text password-rules">
                    Password must contain:
                    <ul class="mb-0">
                        <li id="lengthRule">At least 8 characters</li>
                        <li id="uppercaseRule">One uppercase letter</li>
                        <li id="numberRule">One number</li>
                        <li id="specialRule">One special character</li>
                    </ul>
                </div>
            </div>
            
            <!-- Confirm Password -->
            <div class="mb-4 position-relative">
                <label for="confirmPassword" class="form-label">Confirm Password</label>
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="bi bi-lock-fill"></i>
                    </span>
                    <input type="password" 
                           class="form-control" 
                           id="confirmPassword" 
                           name="confirm_password" 
                           required>
                    <i class="bi bi-eye-slash form-icon" id="toggleConfirmPassword"></i>
                </div>
                <div class="invalid-feedback" id="passwordMatchFeedback">
                    Passwords do not match
                </div>
            </div>
            
            <!-- Terms Checkbox -->
            <div class="mb-4 form-check">
                <input type="checkbox" 
                       class="form-check-input" 
                       id="terms" 
                       name="terms" 
                       required>
                <label class="form-check-label" for="terms">
                    I agree to the <a href="/terms" target="_blank">Terms of Service</a> and 
                    <a href="/privacy" target="_blank">Privacy Policy</a>
                </label>
                <div class="invalid-feedback">
                    You must agree to the terms to register
                </div>
            </div>
            
            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary w-100 py-2 mb-3">
                Create Account
            </button>
            
            <div class="text-center">
                Already have an account? <a href="/login">Sign in</a>
            </div>
        </form>
    </div>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registrationForm');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const togglePassword = document.getElementById('togglePassword');
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const passwordStrength = document.getElementById('passwordStrength');
            const passwordRules = {
                length: document.getElementById('lengthRule'),
                uppercase: document.getElementById('uppercaseRule'),
                number: document.getElementById('numberRule'),
                special: document.getElementById('specialRule')
            };
            
            // Toggle password visibility
            [togglePassword, toggleConfirmPassword].forEach(icon => {
                icon.addEventListener('click', function() {
                    const input = this.id === 'togglePassword' ? passwordInput : confirmPasswordInput;
                    const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                    input.setAttribute('type', type);
                    this.classList.toggle('bi-eye');
                    this.classList.toggle('bi-eye-slash');
                });
            });
            
            // Password strength checker
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                let strength = 0;
                
                // Length check
                if (password.length >= 8) {
                    strength++;
                    passwordRules.length.style.color = '#198754';
                    passwordRules.length.innerHTML = '✓ At least 8 characters';
                } else {
                    passwordRules.length.style.color = '#dc3545';
                    passwordRules.length.innerHTML = 'At least 8 characters';
                }
                
                // Uppercase check
                if (/[A-Z]/.test(password)) {
                    strength++;
                    passwordRules.uppercase.style.color = '#198754';
                    passwordRules.uppercase.innerHTML = '✓ One uppercase letter';
                } else {
                    passwordRules.uppercase.style.color = '#dc3545';
                    passwordRules.uppercase.innerHTML = 'One uppercase letter';
                }
                
                // Number check
                if (/\d/.test(password)) {
                    strength++;
                    passwordRules.number.style.color = '#198754';
                    passwordRules.number.innerHTML = '✓ One number';
                } else {
                    passwordRules.number.style.color = '#dc3545';
                    passwordRules.number.innerHTML = 'One number';
                }
                
                // Special character check
                if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
                    strength++;
                    passwordRules.special.style.color = '#198754';
                    passwordRules.special.innerHTML = '✓ One special character';
                } else {
                    passwordRules.special.style.color = '#dc3545';
                    passwordRules.special.innerHTML = 'One special character';
                }
                
                // Update strength meter
                passwordStrength.className = 'password-strength mt-2 strength-' + strength;
            });
            
            // Password match validation
            confirmPasswordInput.addEventListener('input', function() {
                if (this.value !== passwordInput.value) {
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-invalid');
                }
            });
            
            // Form validation
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                if (passwordInput.value !== confirmPasswordInput.value) {
                    event.preventDefault();
                    confirmPasswordInput.classList.add('is-invalid');
                }
                
                form.classList.add('was-validated');
            }, false);
        });
    </script>
</body>
</html>
